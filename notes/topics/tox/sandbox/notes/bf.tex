\documentclass[11pt,twoside,a4paper]{article}
% tlmgr conf texmf TEXMFHOME ~/.texmf && tlmgr init-usertree && tlmgr install bytefield
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{examplep}

\usepackage{tikz}
\usetikzlibrary{patterns}

\definecolor{lightcyan}{rgb}{0.84,1,1}
\definecolor{lightgreen}{rgb}{0.64,1,0.71}
\definecolor{lightpink}{rgb}{1,0.7,0.7}
\definecolor{lightred}{rgb}{1,0.7,0.71}
\definecolor{peachpuff}{rgb}{1,0.85,0.73}


\makeatletter
\tikzset{% customization of pattern
         % based on <m.wibrow@gm...> - 2013-03-24 07:20:
        hatch distance/.store in=\hatchdistance,
        hatch distance=100pt,
        hatch thickness/.store in=\hatchthickness,
        hatch thickness=5pt
        }
\pgfdeclarepatternformonly[\hatchdistance,\hatchthickness]{north east hatch}% name
    {\pgfqpoint{0pt}{0pt}}% below left
    {\pgfqpoint{\hatchdistance}{\hatchdistance}}% above right
    {\pgfpoint{\hatchdistance-\hatchthickness/1.4}{\hatchdistance-\hatchthickness/1.4}}%
    {
        \pgfsetcolor{\tikz@pattern@color}
        \pgfsetlinewidth{\hatchthickness}
        \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
        \pgfpathlineto{\pgfqpoint{\hatchdistance}{\hatchdistance}}
        \pgfusepath{stroke}
    }
\makeatother

\tikzset{encoded/.style={pattern=north east hatch, pattern color=teal!30, hatch distance=36pt, hatch thickness=10pt}}

\usepackage{bytefield}
\bytefieldsetup{bitheight=\widthof{~0x00~},bitwidth=0.03125\textwidth,boxformatting={\centering\small\sf}}

\newcommand{\hatchedbitbox}[4][lrtb]{\rlap{\bitbox[{#1}]{#3}{\tikz\fill[#2] (0,0) rectangle (\width,\height);}}\bitbox[{#1}]{#3}{#4}}

\begin{document}

\begin{itemize}


\item \PVerb{NET_PACKET_PING_REQUEST}\\[2ex]
\begin{bytefield}{32}
  \bitheader[endianness=little]{0,1,31} \\
  \hatchedbitbox{lightcyan}{1}{\rotatebox{90}{0x00}} &
  \hatchedbitbox{lightgreen}{31}{sender DHT public key (node id)} \\

  \bitheader[lsb=32,endianness=little]{32,33,56,57,58,63} \\
  \hatchedbitbox{lightgreen}{1}{} &
  \hatchedbitbox{lightpink}{24}{random nonce (24)} &
  \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightcyan}}{1}{\rotatebox{90}{0x00}} &
  \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightgreen}}{6}{ping id} \\

  \bitheader[lsb=64,endianness=little]{64,65,66,81} \\
  \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,lightgreen}}{2}{\rotatebox{90}{\parbox{\widthof{~0x00~}}{\centering\scriptsize index \& 0x1ff}}} &
  \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,peachpuff}}{16}{MAC}
\end{bytefield}



\item \PVerb{NET_PACKET_PING_RESPONSE}\\[2ex]
\begin{bytefield}{32}
  \bitheader[endianness=little]{0,1,31} \\
  \hatchedbitbox{lightcyan}{1}{\rotatebox{90}{0x01}} &
  \hatchedbitbox{lightgreen}{31}{sender DHT public key (node id)} \\

  \bitheader[lsb=32,endianness=little]{32,33,56,57,58,63} \\
  \hatchedbitbox{lightgreen}{1}{} &
  \hatchedbitbox{lightpink}{24}{random nonce (24)} &
  \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightcyan}}{1}{\rotatebox{90}{0x01}} &
  \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightgreen}}{6}{ping id} \\

  \bitheader[lsb=64,endianness=little]{64,65,66,81} \\
  \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,lightgreen}}{2}{\rotatebox{90}{\parbox{\widthof{~0x00~}}{\centering\scriptsize index \& 0x1ff}}} &
  \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,peachpuff}}{16}{MAC}
\end{bytefield}
\end{itemize}


% \begin{bytefield}[bitheight=\widthof{~0x00~},bitwidth=0.03125\textwidth,boxformatting={\centering\small\sf}]{32}
%   \bitheader[endianness=little]{0,8,16,24,31} \\
%   \colorbitbox{lightcyan}{1}{\rotatebox{90}{0x00}} &
%   \colorbitbox{lightgreen}{31}{sender DHT public key (node id)} \\

%   \bitheader[lsb=32,endianness=little]{32,40,48,56,63} \\
%   \colorbitbox{lightgreen}{1}{} &
%   \colorbitbox{lightpink}{24}{random nonce (24)} &
%   \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightcyan}}{1}{\rotatebox{90}{0x00}} &
%   \hatchedbitbox{encoded,pattern color=teal!30,preaction={fill,lightgreen}}{6}{ping id} \\

%   \bitheader[lsb=64,endianness=little]{64,72,80,88,95} \\
%   \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,lightgreen}}{2}{ping id}
%   \hatchedbitbox{encoded,pattern color=lightred,preaction={fill,peachpuff}}{16}{MAC}
%   \bitheader[lsb=96,endianness=little]{96,104,112,120,127} \\
% \end{bytefield}
%   \begin{rightwordgroup}{RTP \\ Header}
% \end{rightwordgroup} \\


\end{document}



%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
